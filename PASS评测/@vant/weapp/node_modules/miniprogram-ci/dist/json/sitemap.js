"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSiteMapJSON=void 0;const path=require("path"),lodash_1=require("lodash"),tools_1=require("../utils/tools"),getProjectConfig=require("./projectconfig"),locales=require("../utils/locales/locales"),config_1=require("../config"),common_1=require("../utils/common"),common_2=require("./common"),{schemaValidate:schemaValidate}=require("../validate/schemaValidate");async function getSiteMapJSON(e){const o=await getProjectConfig(e),r=tools_1.normalizePath(path.posix.join(o.miniprogramRoot||"","sitemap.json"));if(!e.stat("",r))return e.type,config_1.COMPILE_TYPE.miniProgramPlugin,{desc:"",rules:[{action:"disallow",page:"*"}]};const t=await e.getFile("",r),i=common_1.checkUTF8(t,r),a=common_2.checkJSONFormat(i,r),c=schemaValidate("sitemap",a);if(c.error.length){const e=c.error.map(e=>"type"===e.errorType||"enum"===e.errorType||"anyOf"===e.errorType?locales.config.JSON_CONTENT_SHOULD_BE.format([e.errorProperty,e.correctType]):locales.config.SHOULD_NOT_BE_EMPTY.format([e.requireProperty])).join("\n");common_1.throwError({msg:e,filePath:r})}return lodash_1.cloneDeep(a)}exports.getSiteMapJSON=getSiteMapJSON;