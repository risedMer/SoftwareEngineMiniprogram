"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compile=exports.compilePlugin=void 0;const path=require("path"),getProjectConfig=require("../json/projectconfig"),common_1=require("./common"),plugin_1=require("../json/plugin/plugin"),game_1=require("./game"),white_ext_list_1=require("../utils/white_ext_list");async function compilePlugin(i,e){const t=await getProjectConfig(i),o=t.pluginRoot,{GameWhiteList:n}=await white_ext_list_1.getWhiteExtList(),s=i.getFileList(o,"").filter(common_1.isNotIgnoredByProjectConfig.bind(null,t,o)).filter(i=>n.has(path.posix.extname(i))),a=await plugin_1.getDevPluginJSON(i,!1),p=s.filter(i=>".js"===path.posix.extname(i)).map(i=>path.posix.relative(o,i)),c=await common_1.compileJSFiles(i,p,o,e),l=s.filter(i=>".js"!==path.posix.extname(i)&&i!==path.posix.join(o,"plugin.json")),g=await common_1.compileOther(i,l,e);return Object.assign(Object.assign({[path.posix.join(o,"plugin.json")]:JSON.stringify(a)},c),g)}async function compile(i,e){const t=await getProjectConfig(i,!1),o=await compilePlugin(i,e),n=await game_1.compile(i,e),s=await common_1.getUploadProjectConfig(i,t);return s.__compileDebugInfo__=e.__compileDebugInfo__||{},Object.assign(Object.assign(Object.assign({},o),n),{"project.config.json":JSON.stringify(s)})}exports.compilePlugin=compilePlugin,exports.compile=compile;