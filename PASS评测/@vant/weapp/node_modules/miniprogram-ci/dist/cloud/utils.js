"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.zipToBuffer=exports.zipFile=void 0;const fs=require("fs"),path=require("path"),JSZip=require("jszip"),minimatch=require("minimatch"),minimatchWithList=(e,i)=>{if(!i)return!1;for(const t of i)if(t.startsWith("!")&&!minimatch(e,t))return!1;for(const t of i)if(!t.startsWith("!")&&minimatch(e,t))return!0;return!1};exports.zipFile=(e,{ignore:i,name:t,zip:r=new JSZip,includeRoot:s=!1}={})=>{if(!fs.existsSync(e))return r;const n=fs.lstatSync(e),o=t||path.basename(e);if(n.isSymbolicLink())r.file(o,fs.readlinkSync(e),{unixPermissions:parseInt("120"+parseInt((n.mode&parseInt("777",8)).toString(8),10),8)});else if(n.isDirectory()){s&&r.folder(o);const t=fs.readdirSync(e);for(let n=0,p=t.length;n<p;n++){const p=t[n],a=s?path.posix.join(o,p):p;i&&minimatchWithList(a,i)||exports.zipFile(path.join(e,p),{zip:r,ignore:i,name:a,includeRoot:!0})}}else r.file(o,fs.readFileSync(e),{binary:!0,unixPermissions:n.mode});return r},exports.zipToBuffer=(e,i)=>e.generateAsync({type:"nodebuffer",platform:"darwin"===process.platform?"UNIX":"DOS",compression:"DEFLATE",compressionOptions:{level:9}},i);